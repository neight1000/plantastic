<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Plantasia â€“ Instrumentation Tribute (Updated)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary-color: #00ffe0;
      --accent-color: #0ffea0;
      --wave-color: #00FF7F;
      --background-color: #000;
      --surface-color: #232323;
      --surface-alpha: rgba(0, 0, 0, 0.92);
      --font-family: monospace, monospace;
      --btn-radius: 8px;
      --shadow: 0 1px 8px #000b;
      --border: 1.5px solid var(--primary-color);
      --focus-outline: 2px solid #fff;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--background-color);
      color: #fff;
      font-family: var(--font-family);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }
    #waveCanvas {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      display: block;
      background: var(--background-color);
    }
    #waveCanvas[aria-label] { outline: none; }
    .ui {
      position: absolute;
      bottom: 0;
      width: 100vw;
      background: var(--surface-alpha);
      padding: 18px 0 10px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-end;
      gap: 18px 16px;
      z-index: 2;
      border-radius: 28px 28px 0 0;
      box-shadow: 0 -2px 32px #000c;
      transition: transform 0.22s cubic-bezier(.87,0,.13,1);
    }
    .ui.closed { transform: translateY(105%); pointer-events: none; }
    .ui.open { transform: translateY(0%); pointer-events: auto; }
    .drawer-toggle-btn {
      position: fixed;
      right: 24px;
      bottom: 26px;
      z-index: 10;
      background: var(--surface-color);
      color: #fff;
      border: var(--border);
      border-radius: var(--btn-radius);
      width: 42px;
      height: 42px;
      font-size: 22px;
      cursor: pointer;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.14s, color 0.14s, border 0.14s;
      outline: none;
    }
    .drawer-toggle-btn.open {
      background: #232323;
      color: var(--accent-color);
      border-color: var(--accent-color);
    }
    .drawer-toggle-btn:focus { outline: var(--focus-outline); }
    #closeDrawer {
      position: absolute;
      top: 7px; right: 17px; z-index: 20;
      width: 32px; height: 32px; border-radius: var(--btn-radius); border: none;
      background: #171717; color: #fff; font-size: 18px; cursor: pointer; font-family: monospace;
      display: flex; align-items: center; justify-content: center;
    }
    #closeDrawer:focus { outline: var(--focus-outline); }
    #infoDisplay {
      position: absolute;
      top: 18px;
      left: 16px;
      z-index: 3;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 13px;
      padding: 14px 17px 14px 15px;
      display: none;
      border-radius: 9px;
      white-space: pre;
      letter-spacing: 0.4px;
      border: 1.5px solid #222;
      box-shadow: 0 2px 18px #000c;
      max-width: 80vw;
    }
    .mod-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 8px;
    }
    .mod-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 7px;
    }
    .mod-row label { font-size: 12px; }
    #midiIndicator {
      position: fixed;
      left: 24px;
      bottom: 24px;
      z-index: 20;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: #222;
      border: 2px solid var(--primary-color);
      box-shadow: 0 0 10px #000a;
      transition: background 0.2s;
    }
    #midiIndicator.active {
      background: var(--primary-color);
      box-shadow: 0 0 20px var(--primary-color);
    }
    @media (max-width:700px) {
      .ui { flex-direction:column; align-items:stretch; max-width:99vw; min-width:90vw; border-radius: 20px 20px 0 0; }
      .ui > div { margin:0 0 8px 0; }
      .ui input[type="range"], .ui select { width: 80vw; }
      .ui button { min-width: 90vw; }
      .drawer-toggle-btn { width: 44px; height: 44px; font-size: 28px; }
    }
    select:focus, input[type="range"]:focus, button:focus { outline: var(--focus-outline); }
  </style>
</head>
<body>
  <canvas id="waveCanvas" aria-label="Waveform visualizer" tabindex="-1"></canvas>
  <div id="midiIndicator" title="MIDI Activity" aria-hidden="true"></div>
  <div id="infoDisplay" aria-live="polite"></div>
  <button id="openDrawer" class="drawer-toggle-btn" title="Open controls" aria-label="Open controls" tabindex="0">&#9776;</button>
  <div class="ui closed" id="drawer" aria-label="Controls Panel">
    <button id="closeDrawer" title="Close controls" aria-label="Close controls" tabindex="0">&#215;</button>
    <div>
      <label for="preset">Preset</label>
      <select id="preset" aria-label="Preset">
        <option value="plants">Plants</option>
        <option value="mold">Mold</option>
        <option value="bacteria">Bacteria</option>
        <option value="mushrooms">Mushrooms</option>
        <option value="harmony">Lifeform Harmony</option>
        <option value="plantasiaClassic">Plantasia Classic</option>
        <option value="greenhouse">Greenhouse Lush</option>
        <option value="cosmicdew">Cosmic Dew</option>
        <option value="daybeam">Daybeam</option>
        <option value="spiralback">Spiral Back</option>
        <option value="rockflora">Planet Rockflora</option>
        <option value="mycomurk">Myco-Murk</option>
        <option value="microburst">Microburst</option>
        <option value="fibonaccishift">Fibonacci Shift</option>
      </select>
    </div>
    <!-- (Other controls, similar format, omitted for brevity) -->
    <button id="play" aria-label="Play (space)" title="Play (space)">PLAY</button>
    <button id="stop" aria-label="Stop" title="Stop">STOP</button>
    <button id="toggleDisplay" aria-label="Show instrument data" title="Show instrument data">DATA</button>
    <button id="toggleMidiIn" aria-label="Toggle MIDI input" title="Toggle MIDI input">midi</button>
  </div>
  <div id="loading" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111c;padding:2em 3em;color:#fff;border-radius:1em;z-index:99;font-size:1.3em;">
    Loading...
  </div>
  <script>
    // DOM helpers
    const $ = id => document.getElementById(id);

    // Drawer logic with accessibility
    const drawer = $("drawer");
    const openDrawerBtn = $("openDrawer");
    const closeDrawerBtn = $("closeDrawer");
    openDrawerBtn.addEventListener('click', openDrawer);
    closeDrawerBtn.addEventListener('click', closeDrawer);
    openDrawerBtn.addEventListener('keydown', e => {
      // (continued...)
    });
    // (continued...)
  </script>
</body>
</html>
